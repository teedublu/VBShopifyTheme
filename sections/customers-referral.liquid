{% assign referrals = customer.metafields.referrals.hasreferred.value %}
{% assign referrals_count = referrals.size %}

<div class="container">
  {%- if referrals_count == 0 -%}
    <div class="empty-state">
      <div class="empty-state__icon-wrapper">
        {%- render 'icon' with 'picto-chat', width: 32, height: 32, stroke_width: 1 -%}
        <span class="count-bubble count-bubble--lg">0</span>
      </div>

      <div class="prose">
        <p class="h6">You haven't made any referrals yet!</p>

        {%- assign button_content = 'customer.account.continue_shopping' | t -%}
        {%- render 'button', href: routes.all_products_collection_url, size: 'xl', content: button_content -%}
      </div>
    </div>
  {%- else -%}

    <div class="page-spacer">
      <div class="account">
        <div class="account-header">
          <div class="text-with-bubble justify-self-center">
            <h1 class="h3">Referrals</h1>
            <span class="count-bubble count-bubble--lg">{{referrals_count}}</span>
          </div>
        </div>

        
          <div class="account__block-list">
            <div class="v-stack gap-5" {{ block.shopify_attributes }}>
              <div class="grid-list">
                {%- for referral in referrals -%}
                  <div>
                    {{referral | split: '@' | first | append: '*****'}}
                    {% comment %}TODO add a star to the orders list where the gift card comes from a referral {% endcomment %}
                  </div>
                {%- endfor -%}
              </div>

            </div>
          </div>

      </div>
    </div>
  {%- endif -%}
</div>

{% schema %}
{
  "name": "Customer referral",
  "class": "shopify-section--main-customers-referral",
  "tag": "section",
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "liquid",
      "name": "Liquid",
      "settings": [
        {
          "type": "liquid",
          "id": "liquid",
          "label": "Liquid"
        }
      ]
    },
    {
      "type": "referrals",
      "name": "Referral list",
      "limit": 1
    }
  ]
}
{% endschema %}