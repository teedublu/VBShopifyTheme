
<div {% render 'section-properties' %}>
  {% if customer %}
    {% assign children = customer.metafields.custom.children.value | parse_json %}
    <!-- Content for logged-in users -->
    <div class="customer-audiobooks">
      <h1>Your Purchased Audiobooks</h1>
      
      <ul id="audiobooks-list">
        {% assign customer_orders = customer.orders %}
        {% for order in customer_orders %} 
          {% for line_item in order.line_items %}
          {%- assign current_variant = line_item.product.selected_or_first_available_variant -%}

            {% if current_variant.sku contains "BK-" %}{{order.id}}//{{line_item.id}}
              <li>
                {{ line_item.title }} - Purchased on {{ order.created_at | date: "%B %d, %Y" }}{{children|json}}
                <ul id="children">
                  {% for child in children %}
                    <li>{{ child.name }}</li>
                  {%- endfor -%}
                </ul>
              </li>
            {% endif %}
          {% endfor %}
        {% endfor %}
      </ul>
    </div>
  {% else %}
    <!-- Content for users who are not logged in -->
    <p>Please log in to view your purchased audiobooks.</p>
  {% endif %}
</div>

{% schema %}
{
  "name": "Customer Audiobooks",
  "class": "shopify-section--customer-audiobooks",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "example_text",
      "label": "Example Text",
      "default": "Placeholder text"
    }
  ],
  "presets":  [
    {
      "name": "Customer Audiobooks",
      "category": "Custom Sections"
    }
  ]

}
{% endschema %}
