<style>
  .object-list {
    list-style: none; /* Removes default list styling */
    padding: 0; /* Removes default padding */
  }
  .object-item {
    display: flex; /* Enables flexbox layout */
    align-items: center; /* Vertical alignment */
    margin-bottom: 10px; /* Adds space between items */
  }
  .object-image {
    flex: 0 0 auto; /* Image does not grow or shrink */
    width: 50px; /* Set width to 50px */
    height: 50px; /* Set height to 50px */
    margin-right: 10px; /* Adds space between the image and text */
    overflow: hidden; /* Ensures the image does not bleed outside the container */
    display: flex; /* Ensures proper alignment */
    align-items: center; /* Centers the image vertically */
    justify-content: center; /* Centers the image horizontally */
    border-radius: 50%;
  }

  .object-image img, .object-image svg {
    width: 100%; /* Ensure the image covers the full width */
    height: 100%; /* Ensure the image covers the full height */
    object-fit: cover; /* Crop to cover the area */
  }

  .object-text {
    flex: 1; /* Takes up the rest of the space */
    display: flex;
    flex-direction: column; /* Stacks the title and author/narrator info vertically */
  }
  .object-title, .object-authors-narrators {
    flex: 1; /* Each text section takes equal vertical space */
  }
  .object-authors-narrators {
    font-size: 80%;
  }
  .object-authors-narrators a{
    font-weight: bold;
  }
</style>



<script type="application/ld+json">

{%- assign title = page.metafields.global.title_tag | default: page.title -%}

  {
    "@context": "http://schema.org",
    "@type": "CollectionPage",
    {% if collection.description != blank %}
      "description": {{ collection.description | strip_html | json }},
    {% endif %}

    "name": {{ title | json }},
    "url": "{{ shop.url }}{{ collection.url }}",

    "mainEntity" : {
      "@type": "ItemList",
      "itemListElement": [
        {% paginate collections['audiobooks'].products by 1000 %}
    
          {% for product in collections['audiobooks'].products  %}
            {%- assign author = product.metafields.book.authors.value | first -%}
            {
              "@type": "ListItem",
              "position": {{ forloop.index }},
              "item": {
                "@type": "Audiobook",
                "@id":  "{{ shop.url }}{{ product.url }}",
                "url": "{{ shop.url }}{{ product.url }}#audiobook",
                "name": "{{ product.title }}",
                "author": "{{ author.name }}",
                "description": "{{ product.title }} as a physical audiobook"
              }
            }{% unless forloop.last %},{% endunless %}
          {%- endfor -%}
        {%- endpaginate -%}
      ]
    }
  }
  
</script>

<div class="container">
  <div class="page">
    <div class="metaobjects index-list collection">

      {% assign object_type = section.settings.object_type %}
      {% unless object_type == 'audiobook'  %} 
        {% assign object_type = object_type | append: 's' %}
      {% endunless %}
      {% assign objects = null | sort %}

      {% paginate collections['audiobooks'].products by 1000 %}
        
        {% for product in collections['audiobooks'].products  %}
          {% if object_type == 'audiobook' %}
            {% comment %} This single object {% endcomment %}
            {% assign o = product.metafields.book['audiobook'].value | sort  %}
            {% assign objects = objects | concat: o  %}
            
          {% else %}
            {% comment %} This array of objects {% endcomment %}
            {% for object in product.metafields.book[object_type].value  %}
              {% assign o = object | sort  %}
              {% assign objects = objects | concat: o  %}
            {% endfor %}
          {% endif %}
        {% endfor %}
      {% endpaginate %}

      {% assign objects = objects | uniq %}
      {% assign objects = objects | sort: 'name' %}
      
      <ul class="object-list">
        {% for metaobject in objects  %}
          {% assign image = nil %}
          <li class="object-item">
            <div class="object-image">
              {% if metaobject.product.value.featured_image %}
                {% assign image = metaobject.product.value.featured_image %}
              {% elsif metaobject.photos %}
                {% assign image = metaobject.photos.value | first %}
              {% endif %}
              {% if image != blank %}
                {{ image | image_url: width: 100 | image_tag: alt: metaobject.title.value | escape }}
              {% else %}
                {{ 'image' | placeholder_svg_tag: 'placeholder' }}
              {% endif %}
            </div>
            <div class="object-text">
              {% case section.settings.object_type %}
                {% when 'audiobook' %}
                  <div class="object-title">
                    <b>{{ metaobject.title.value | link_to: metaobject.system.url, class: section.settings.object_type}}</b>
                  </div>
                  {% if metaobject.product.value.metafields.book.authors.value %}
                    <div class="object-authors-narrators">
                      Written by: 
                      {% for author in metaobject.product.value.metafields.book.authors.value %} 
                        {{ author.name | link_to: author.system.url, class: 'author'}}{% unless forloop.last %}, {% endunless %}
                      {% endfor %}
                    </div>
                  {% endif %}
                  {% if metaobject.product.value.metafields.book.narrators.value %}
                    <div class="object-authors-narrators">
                      Narrated by: 
                      {% for narrator in metaobject.product.value.metafields.book.narrators.value %} 
                        {{ narrator.name | link_to: narrator.system.url, class: 'narrator' }}{% unless forloop.last %}, {% endunless %}
                      {% endfor %}
                    </div>
                  {% endif %}
                {% else %}
                  <div class="object-title">{{ metaobject.name | link_to: metaobject.system.url, class: section.settings.object_type}}</div>
              {% endcase %}
            </div>
          </li>
        {% endfor %}
      </ul>

    </div>
  </div>
</div>


{% schema %}
{
  "name": "Metaobjects list",
  "class": "shopify-section--logo-list",
  "tag": "section",
  "disabled_on": {
    "templates": ["password"],
    "groups": ["header", "custom.overlay"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Metaobjects",
      "info": "Paginated list of metaobjects."
    },
    {
      "type": "range",
      "id": "page_size",
      "label": "Page size",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 25
    },
    {
      "type": "select",
      "id": "object_type",
      "label": "Object type",
      "options": [
        {
          "value": "audiobook",
          "label": "Audiobooks"
        },
        {
          "value": "authors",
          "label": "Authors"
        },
        {
          "value": "narrators",
          "label": "Narrators"
        },
        {
          "value": "characters",
          "label": "Characters"
        },
        {
          "value": "publisher",
          "label": "Publishers"
        }
      ],
      "info": "Choose a metaobject to paginate over",
      "default": "authors"
    }
  ],
  "blocks": [

  ],
  "presets": [
    {
      "name": "Metaobjects list",
      "blocks": [
        
      ]
    }
  ]
}
{% endschema %}

