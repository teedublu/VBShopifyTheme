{%- assign video_object = section.settings.video.sources | where: 'format', 'mp4' | first -%}
{%- assign content_url = video_object.url -%}
{%- assign youtube_id = section.settings.youtube_id -%}
{%- assign audiobook = product.metafields.book.audiobook -%}

{%- if product -%}
  
  {
    "@context": "https://schema.org",
    "@type": "VideoObject",
    "name": {{ product.title | prepend: 'Video of ' | json }},
    "description": "{{ product.description | strip_html | escape | strip_newlines }}",
    "uploadDate": "2022-08-31T08:00:00+08:00",
    "contentUrl": "{{ content_url }}",
    {%- if youtube_id -%}
      "thumbnailUrl": [
        "https://img.youtube.com/vi/{{ youtube_id }}/default.jpg",
        "https://img.youtube.com/vi/{{ youtube_id }}/sddefault.jpg",
        "https://img.youtube.com/vi/{{ youtube_id }}/mqdefault.jpg",
        "https://img.youtube.com/vi/{{ youtube_id }}/maxresdefault.jpg"
      ],
      "embedUrl": "https://www.youtube.com/embed/{{ youtube_id }}",
    {%- endif -%}
    "publisher": {%- render 'microdata-snippet-publisher' -%},
    "encodesCreativeWork": {
      "@type": "Audiobook",
      "name": {{ product.title | json }}
    }
  }
{%- else -%}
  {
    "@context": "https://schema.org",
    "@type": "VideoObject",
    "name": "How Voxblock works",
    "description": "Learn how Voxblock plays screen-free audiobooks. See how simple it is to use.",
    "uploadDate": "2022-08-31T08:00:00+08:00",
    "contentUrl": "{{ content_url }}",
    {%- if youtube_id -%}
      "thumbnailUrl": [
        {{ video_object.preview_image | img_url: '300x300' }},
        "https://img.youtube.com/vi/{{ youtube_id }}/default.jpg",
        "https://img.youtube.com/vi/{{ youtube_id }}/sddefault.jpg",
        "https://img.youtube.com/vi/{{ youtube_id }}/mqdefault.jpg",
        "https://img.youtube.com/vi/{{ youtube_id }}/maxresdefault.jpg"
      ],
      "embedUrl": "https://www.youtube.com/embed/{{ youtube_id }}",
    {%- endif -%}
    "publisher": {%- render 'microdata-snippet-publisher' -%},

    "encodesCreativeWork": {
      "@type": "HowTo",
      "name": "How Voxblock works"
    }
  }
{%- endif -%}