{%- liquid
  assign current_variant = product.selected_or_first_available_variant
  assign days_price_valid_until = 10 | times: 86400
  assign gtin_option = 'gtin'
  assign is_barcode_available = false
  if current_variant.barcode != blank
    assign is_barcode_available = true
    assign gtin_string_length = current_variant.barcode | size
    if gtin_string_length == 8 or gtin_string_length == 12 or gtin_string_length == 13 or gtin_string_length == 14
      assign is_valid_gtin_length = true
      assign gtin_option = gtin_option | append: gtin_string_length
    endif
  endif
-%}

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Product",
  "productID": {{ current_variant.sku | json }},
  "additionalType": "http://www.productontology.org/id/Audiobook",
  {%- if product.metafields.book.uri != blank -%}
      "@id": "{{ product.metafields.book.uri }}",
  {%- endif -%}
  "offers": [
    {%- for variant in product.variants -%}
      {
        "@type" : "Offer",
        {%- if variant.sku != blank -%}
          "sku": {{ variant.sku | json }},
        {%- endif -%}
        "availability" : "http://schema.org/{% if variant.available %}InStock{% else %}OutOfStock{% endif %}",
        "price" : {{ variant.price | divided_by: 100.00 | json }},
        "priceCurrency" : {{ cart.currency.iso_code | json }},
        "priceValidUntil": "{{ 'now' | date: '%s' | plus: days_price_valid_until | date: '%Y-%m-%d' }}",
        "url" : {{ shop.url | append: variant.url | json }},
        "shippingDetails": {
          "@type": "OfferShippingDetails",
          "shippingRate": {
            "@type": "MonetaryAmount",
            "value": "0",
            "currency": "GBP"
          },
          "shippingDestination": [
            {
              "@type": "DefinedRegion",
              "addressCountry": "UK"
            }
          ],
          "deliveryTime": {
            "@type": "ShippingDeliveryTime",
            "businessDays": {
                "@type": "OpeningHoursSpecification",
                "dayOfWeek": [
                    "https://schema.org/Monday",
                    "https://schema.org/Tuesday",
                    "https://schema.org/Wednesday",
                    "https://schema.org/Thursday",
                    "https://schema.org/Friday"
                ]
            },
            "cutoffTime": "12:00:15Z",
            "handlingTime": {
                "@type": "QuantitativeValue",
                "minValue": 0,
                "maxValue": 1,
                "unitCode": "d"
            },
            "transitTime": {
                "@type": "QuantitativeValue",
                "minValue": 1,
                "maxValue": 2,
                "unitCode": "d"
            }
          }
        },
        "hasMerchantReturnPolicy": {
          "@type": "MerchantReturnPolicy",
          "applicableCountry": "UK",
          "returnPolicyCategory": "https://schema.org/MerchantReturnFiniteReturnWindow",
          "merchantReturnDays": 30,
          "returnMethod": "https://schema.org/ReturnByMail",
          "returnFees": "https://schema.org/ReturnFeesCustomerResponsibility",
          "refundType": "FullRefund"
        }
      }{% unless forloop.last %},{% endunless %}
    {%- endfor -%}

  ],
  "sku": {{ current_variant.sku | json }},
  "name": {{ product.title | json }},
  "brand": {
      "@type": "Brand",
      "name": "Voxblock"
  },
  "description": {{ product.description | strip_html | json }},
  "category": "",
  "url": "{{ shop.url }}{{ product.url }}",
  "isbn": {{ current_variant.barcode | json }},
  "gtin13": {{ current_variant.barcode | json }},
  
  "image": {
    "@type": "ImageObject",
    "url": "https:{{ product.featured_media.preview_image | img_url: '1024x1024' }}",
    "image": "https:{{ product.featured_media.preview_image | img_url: '1024x1024' }}",
    "name": {{ product.title | json }},
    "width": 1024,
    "height": 1024
  }
}
</script>